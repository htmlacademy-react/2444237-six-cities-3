import{j as e,u as p,r as v,e as x,m as g,n as w,b as c,c as b,k as _,o as y,A as O,p as S,q as C,t as A,v as F,w as M,S as R,F as P,H as E,x as T,M as k,i as D,O as I}from"./index-e5014da0.js";import{z as m,u as L,a as $}from"./zod-ed979502.js";const z=a=>a.offer.offer,H=a=>a.offer.nearOffers,U=a=>a.offer.isLoading,G=6,V=({images:a})=>e.jsx("div",{className:"offer__gallery-container container",children:e.jsx("div",{className:"offer__gallery",children:a.slice(0,G).map(r=>e.jsx("div",{className:"offer__image-wrapper",children:e.jsx("img",{className:"offer__image",src:r,alt:"Studio"})},r))})}),B=({goods:a})=>e.jsxs("div",{className:"offer__inside",children:[e.jsx("h2",{className:"offer__inside-title",children:"What's inside"}),e.jsx("ul",{className:"offer__inside-list",children:a.map(r=>e.jsx("li",{className:"offer__inside-item",children:r},r))})]}),W=a=>a.comment.comments,X=[{id:"5-stars",title:"perfect",value:5},{id:"4-stars",title:"good",value:4},{id:"3-stars",title:"not bad",value:3},{id:"2-stars",title:"badly",value:2},{id:"1-stars",title:"terribly",value:1}],Y="_error_1rcfe_1",q="_error_text_1rcfe_8",o={error:Y,error_text:q},J=m.object({rating:m.string().min(1).max(5).refine(a=>{const r=Number(a);return r>=1&&r<=5}),comment:m.string().min(50).max(300)}),K=({offerId:a})=>{var h,u;const{register:r,formState:{errors:s,isValid:t,isSubmitting:l},handleSubmit:d,reset:n}=L({resolver:$(J),defaultValues:{comment:"",rating:"0"}}),f=p(),j=async({rating:i,comment:N})=>{if(a)try{await f(g({offerId:a,comment:{rating:Number(i),comment:N}})).unwrap(),n()}catch{f(w("Произошла ошибка при отправке комментария"))}};return e.jsxs("form",{className:"reviews__form form",action:"#",method:"post",onSubmit:i=>{i.preventDefault(),d(j)()},children:[e.jsx("label",{className:"reviews__label form__label",htmlFor:"review",children:"Your review"}),e.jsx("div",{className:"reviews__rating-form form__rating",children:X.map(i=>e.jsxs(v.Fragment,{children:[e.jsx("input",{className:x("form__rating-input visually-hidden",{[o.error]:!!s.rating}),value:i.value,id:i.id,type:"radio",disabled:l,...r("rating")},i.id),e.jsx("label",{htmlFor:i.id,className:"reviews__rating-label form__rating-label",title:i.title,children:e.jsx("svg",{className:"form__star-image",width:37,height:33,children:e.jsx("use",{xlinkHref:"#icon-star"})})})]},i.id))}),s.rating&&e.jsx("div",{className:o.error_text,children:(h=s.rating)==null?void 0:h.message}),e.jsx("textarea",{className:x("reviews__textarea form__textarea",{[o.error]:s.comment}),id:"review",placeholder:"Tell how was your stay, what you like and what can be improved",defaultValue:"",disabled:l,...r("comment")}),s.comment&&e.jsx("div",{className:o.error_text,children:(u=s.comment)==null?void 0:u.message}),e.jsxs("div",{className:"reviews__button-wrapper",children:[e.jsxs("p",{className:"reviews__help",children:["To submit review please make sure to set"," ",e.jsx("span",{className:"reviews__star",children:"rating"})," and describe your stay with at least ",e.jsx("b",{className:"reviews__text-amount",children:"50 characters"}),"."]}),e.jsx("button",{className:"reviews__submit form__submit button",type:"submit",disabled:!t||l,children:"Submit"})]})]})},Q=10,Z=a=>[...a].sort((s,t)=>new Date(t.date).getTime()-new Date(s.date).getTime()).slice(0,Q),ee=({offerId:a})=>{const r=c(W),s=c(b);return e.jsxs("section",{className:"offer__reviews reviews",children:[e.jsxs("h2",{className:"reviews__title",children:["Reviews · ",e.jsx("span",{className:"reviews__amount",children:r.length})]}),e.jsx("ul",{className:"reviews__list",children:Z(r).map(t=>e.jsxs("li",{className:"reviews__item",children:[e.jsxs("div",{className:"reviews__user user",children:[e.jsx("div",{className:"reviews__avatar-wrapper user__avatar-wrapper",children:e.jsx("img",{className:"reviews__avatar user__avatar",src:t.user.avatarUrl,width:54,height:54,alt:"Reviews avatar"})}),e.jsx("span",{className:"reviews__user-name",children:t.user.name})]}),e.jsxs("div",{className:"reviews__info",children:[e.jsx("div",{className:"reviews__rating rating",children:e.jsxs("div",{className:"reviews__stars rating__stars",children:[e.jsx("span",{style:{width:`${_(t.rating)}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]})}),e.jsx("p",{className:"reviews__text",children:t.comment}),e.jsx("time",{className:"reviews__time",dateTime:"2019-04-24",children:y(t.date)})]})]},t.date+t.user.name))}),s===O.Auth&&e.jsx(K,{offerId:a})]})},te=()=>{const{id:a}=S(),r=p(),s=c(z),t=C(c(H)),l=c(U);v.useEffect(()=>{a&&(r(A(a)),r(F(a)),r(M(a)))},[r,a]);const d=[...t,s];return l?e.jsx(R,{}):s?e.jsxs(e.Fragment,{children:[e.jsx(E,{}),e.jsxs("main",{className:"page__main page__main--offer",children:[e.jsxs("section",{className:"offer",children:[e.jsx(V,{images:s.images}),e.jsx("div",{className:"offer__container container",children:e.jsxs("div",{className:"offer__wrapper",children:[s.isPremium&&e.jsx("div",{className:"offer__mark",children:e.jsx("span",{children:"Premium"})}),e.jsxs("div",{className:"offer__name-wrapper",children:[e.jsx("h1",{className:"offer__name",children:s.title}),e.jsx(T,{id:s.id,type:"offer"})]}),e.jsxs("div",{className:"offer__rating rating",children:[e.jsxs("div",{className:"offer__stars rating__stars",children:[e.jsx("span",{style:{width:`${_(s.rating)}%`}}),e.jsx("span",{className:"visually-hidden",children:"Rating"})]}),s&&e.jsx("span",{className:"offer__rating-value rating__value",children:s.rating})]}),e.jsxs("ul",{className:"offer__features",children:[s&&s.type&&e.jsx("li",{className:"offer__feature offer__feature--entire",children:s.type}),e.jsxs("li",{className:"offer__feature offer__feature--bedrooms",children:[s.bedrooms," Bedrooms"]}),e.jsx("li",{className:"offer__feature offer__feature--adults",children:`Max ${s.maxAdults} ${s.maxAdults>1?"adults":"adult"}`})]}),e.jsxs("div",{className:"offer__price",children:[s&&e.jsxs("b",{className:"offer__price-value",children:["€",s.price]}),e.jsx("span",{className:"offer__price-text",children:" night"})]}),e.jsx(B,{goods:s.goods}),e.jsxs("div",{className:"offer__host",children:[e.jsx("h2",{className:"offer__host-title",children:"Meet the host"}),e.jsxs("div",{className:"offer__host-user user",children:[e.jsx("div",{className:`offer__avatar-wrapper ${s.host.isPro&&"offer__avatar-wrapper--pro"} user__avatar-wrapper`,children:e.jsx("img",{className:"offer__avatar user__avatar",src:s==null?void 0:s.host.avatarUrl,width:74,height:74,alt:"Host avatar"})}),e.jsx("span",{className:"offer__user-name",children:s.host.name}),s.host.isPro&&e.jsx("span",{className:"offer__user-status",children:"Pro"})]}),e.jsx("div",{className:"offer__description",children:e.jsx("p",{className:"offer__text",children:s.description})})]}),e.jsx(ee,{offerId:a})]})}),e.jsx(k,{className:"offer__map map",offers:d,activeOfferId:s==null?void 0:s.id})]}),e.jsx("div",{className:"container",children:e.jsxs("section",{className:"near-places places",children:[e.jsx("h2",{className:"near-places__title",children:"Other places in the neighbourhood"}),e.jsx("div",{className:"near-places__list places__list",children:t.map(n=>e.jsx(D,{id:n.id,image:n.previewImage,price:n.price,rating:_(n.rating),name:n.title,type:n.type,className:I.near,width:"260",height:"200",view:"near"},n.id))})]})})]})]}):e.jsx(P,{})};export{te as default};
